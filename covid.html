<!doctype html>
<html lang="fr">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca&display=swap" rel="stylesheet">
    <title>Dashboard Covid.</title>
    <!-- Favicon -->
    <link rel="icon" href="img/favicon.ico" id="light-scheme-favicon" />
    <link rel="icon" href="img/faviconBlanc.ico" id="dark-scheme-favicon" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1"></script>
    <script src="ressources/papaparse.min.js"></script>
</head>

<body style="background-color: #FAF7FF;">
    <div style="background-color: #FAF7FF; min-height: 100vh;">
        <div style="position: absolute ;height: 150px; width: 35vw ;top: 0px; background-color: #6219D8;">
            <img src="img/header/Fichier 6.svg" style="width: 1000px; position: absolute; top: 0px; right: -50px">
        </div>
        <div class="container text-center" style="position: relative; z-index: 1980; padding: 80px 15px">
            <div class="container-fluid text-center">
                <img src="img/LOGO_JTV_ALT.svg" style="opacity: .05; position: absolute; top: 10px; max-width: 350px;">
                <h1>Vaccinations COVID en France.</h1><br>
                <h3 class="fancyPhrase">Un dashboard <span class="meaJtv">en temps réel </span>pour suivre l'avancée de
                    la vaccination contre la Covid-19 en
                    France.</h3>
            </div>

            <div class="container neumorphSection" data-aos="flip-down">
                <div class="container text-center">
                    <h4>Nombre de personnes vaccinées contre la Covid-19 en France.</h4>
                    <div class="col-sm" style="padding: 20px 0px;">
                        <canvas id="chart6_general_vacc" style="min-height: 300px;"></canvas>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="container neumorphSection" data-aos="flip-down">
                        <div class="container text-center">
                            <h4>Part de la population vaccinée <br>en France.</h4>
                            <div class="col-sm" style="padding: 20px 0px;">
                                <canvas id="chart7_partvax" style="min-height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="container neumorphSection" data-aos="flip-down" data-aos-delay="100">
                        <div class="container text-center">
                            <h4>Les régions françaises les <br>plus/moins vaccinées.</h4>
                            <div class="col-sm" style="padding: 20px 0px;">
                                <canvas id="chart9_regionVax" style="min-height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container neumorphSection" data-aos="flip-down">
                    <div class="container text-center">
                        <h4>La France en comparaison des autres pays.</h4>
                        <div class="col-sm" style="padding: 20px 0px;">
                            <canvas id="chart10_VaxCompet" style="min-height: 400px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container neumorphSection" data-aos="flip-down">
                <div class="container text-left">
                    <h4>Pour aller plus loin...</h4>
                    <p>De nombreuses ressources permettent de suivre l'évolution de la pandémie dans le monde entier.
                        <br>Nous vous proposons une sélection des meilleurs d'entre eux :
                    </p>
                    <div class="row">
                        <div class="col-md-4" style="padding: 10px;">
                            <div class="card h-100">
                                <div
                                    class="card-body d-flex align-content-between flex-wrap justify-content-center text-center">
                                    <h5 class="card-title">Covid Tracker</h5>
                                    <p class="card-text">Le dashboard le plus complet pour suivre l'actualité COVID-19.
                                        Merci Guillaume Rozier!</p>
                                    <a href="https://covidtracker.fr/" target="_blank" rel="noopener noreferrer"
                                        class="btn jtvBtn">Voir</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4" style="padding: 10px;">
                            <div class="card h-100">
                                <div
                                    class="card-body d-flex align-content-between flex-wrap justify-content-center text-center">
                                    <h5 class="card-title">TousAntiCovid</h5>
                                    <p class="card-text">La meilleure application pour s'informer et se protéger du
                                        virus.</p>
                                    <a href="https://www.gouvernement.fr/info-coronavirus/tousanticovid" target="_blank"
                                        rel="noopener noreferrer" class="btn jtvBtn">Voir</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4" style="padding: 10px;">
                            <div class="card h-100">
                                <div
                                    class="card-body d-flex align-content-between flex-wrap justify-content-center text-center">
                                    <h5 class="card-title">Reportages du Monde</h5>
                                    <p class="card-text">La série documentaire du Monde pour mieux comprendre les enjeux
                                        liés au COVID-19.</p>
                                    <a href="https://www.youtube.com/playlist?list=PLFuK0VAIne9J9IgbRJAciLFZ264m4j46g"
                                        target="_blank" rel="noopener noreferrer" class="btn jtvBtn">Voir</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <script>
            Chart.pluginService.register({
                beforeDraw: function (chart) {
                    if (chart.config.options.elements.center) {
                        // Get ctx from string
                        var ctx = chart.chart.ctx;

                        // Get options from the center object in options
                        var centerConfig = chart.config.options.elements.center;
                        var fontStyle = centerConfig.fontStyle || 'Arial';
                        var txt = centerConfig.text;
                        var color = centerConfig.color || '#000';
                        var maxFontSize = centerConfig.maxFontSize || 75;
                        var sidePadding = centerConfig.sidePadding || 20;
                        var sidePaddingCalculated = (sidePadding / 100) * (chart.innerRadius * 2)
                        // Start with a base font of 30px
                        ctx.font = "30px " + fontStyle;

                        // Get the width of the string and also the width of the element minus 10 to give it 5px side padding
                        var stringWidth = ctx.measureText(txt).width;
                        var elementWidth = (chart.innerRadius * 2) - sidePaddingCalculated;

                        // Find out how much the font can grow in width.
                        var widthRatio = elementWidth / stringWidth;
                        var newFontSize = Math.floor(30 * widthRatio);
                        var elementHeight = (chart.innerRadius * 2);

                        // Pick a new font size so it will not be larger than the height of label.
                        var fontSizeToUse = Math.min(newFontSize, elementHeight, maxFontSize);
                        var minFontSize = centerConfig.minFontSize;
                        var lineHeight = centerConfig.lineHeight || 25;
                        var wrapText = false;

                        if (minFontSize === undefined) {
                            minFontSize = 20;
                        }

                        if (minFontSize && fontSizeToUse < minFontSize) {
                            fontSizeToUse = minFontSize;
                            wrapText = true;
                        }

                        // Set font settings to draw it correctly.
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        var centerX = ((chart.chartArea.left + chart.chartArea.right) / 2);
                        var centerY = ((chart.chartArea.top + chart.chartArea.bottom) / 2);
                        ctx.font = fontSizeToUse + "px " + fontStyle;
                        ctx.fillStyle = color;

                        if (!wrapText) {
                            ctx.fillText(txt, centerX, centerY);
                            return;
                        }

                        var words = txt.split(' ');
                        var line = '';
                        var lines = [];

                        // Break words up into multiple lines if necessary
                        for (var n = 0; n < words.length; n++) {
                            var testLine = line + words[n] + ' ';
                            var metrics = ctx.measureText(testLine);
                            var testWidth = metrics.width;
                            if (testWidth > elementWidth && n > 0) {
                                lines.push(line);
                                line = words[n] + ' ';
                            } else {
                                line = testLine;
                            }
                        }

                        // Move the center up depending on line height and number of lines
                        centerY -= (lines.length / 2) * lineHeight;

                        for (var n = 0; n < lines.length; n++) {
                            ctx.fillText(lines[n], centerX, centerY);
                            centerY += lineHeight;
                        }
                        //Draw text in center
                        ctx.fillText(line, centerX, centerY);
                    }
                }
            });
        </script>

        <script>
            let dataTotalVacc,
                labelsTV,
                dataTV,
                dataPays = [];
            Papa.parse("https://www.data.gouv.fr/fr/datasets/r/efe23314-67c4-45d3-89a2-3faef82fae90", {
                download: true,
                complete: function (results, file) {
                    let newJsonObj = results.data;
                    newJsonObj.shift();
                    newJsonObj.pop();
                    labelsTV = newJsonObj.map(e => e[1])
                    dataTV = newJsonObj.map(e => e[3])

                    //graph vacc total
                    var ctxx = document.querySelector('#chart6_general_vacc').getContext('2d');
                    var chart = new Chart(ctxx, {
                        type: 'bar',
                        data: {
                            labels: labelsTV,
                            datasets: [{
                                label: "Population vaccinée contre le COVID-19 en France.",
                                backgroundColor: '#6219D8',
                                data: dataTV
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                position: "bottom",
                                fontFamily: "Lexend Deca",
                                text: "Source : data.gouv.fr"
                            },
                            tooltips: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                yAxes: [{
                                    stacked: true,
                                    ticks: {
                                        stepSize: 500000,
                                        userCallback: function (value, index, values) {
                                            value = value.toString();
                                            value = value.split(/(?=(?:...)*$)/);
                                            value = value.join(',');
                                            return value;
                                        }
                                    }
                                }],
                                xAxes: [{
                                    gridLines: {
                                        display: false
                                    },
                                    ticks: {
                                        autoSkip: true,
                                        maxTicksLimit: 15
                                    }
                                }]
                            },
                            maintainAspectRatio: false,
                            plugins: {
                                deferred: {
                                    xOffset: 150,
                                    yOffset: '50%',
                                    delay: 500
                                }
                            },
                        }
                    });

                    var ctxpart = document.querySelector('#chart7_partvax').getContext('2d');
                    var CTchart7_partvax = new Chart(ctxpart, {
                        type: 'doughnut',
                        data: {
                            labels: ["Population non-vaccinée", "Population vaccinée"],
                            datasets: [{
                                label: "Indice de popularité",
                                backgroundColor: ["#bebbc4", "#6219D8"],
                                data: ["67400000", dataTV.slice(-1).pop()]
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                position: "bottom",
                                fontFamily: "Lexend Deca",
                                padding: 20,
                                fontSize: 14,
                                text: "Source : data.gouv.fr"
                            },
                            tooltips: {
                                mode: 'index',
                                intersect: false
                            },
                            maintainAspectRatio: false,
                            plugins: {
                                deferred: {
                                    xOffset: 150,
                                    yOffset: '50%',
                                    delay: 500
                                }
                            },
                            elements: {
                                center: {
                                    text: String(Math.round(dataTV.slice(-1).pop() / 67400000 *
                                            1000) /
                                        10) + "%",
                                    color: '#6219D8',
                                    fontStyle: 'Lexend Deca',
                                    sidePadding: 40, //  
                                    minFontSize: 16, // 
                                    lineHeight: 25 // 
                                }
                            }
                        }
                    });
                }
            });

            let codeRegions = {
                '01': 'Guadeloupe',
                '02': 'Martinique',
                '03': 'Guyane',
                '04': 'La Reunion',
                '06': 'Mayotte',
                '07': 'Mayotte',
                '11': 'Ile de France',
                '24': 'Val de Loire',
                '27': 'Bourgogne Franche Comte',
                '28': 'Normandie',
                '32': 'Hauts de France',
                '44': 'Grand Est',
                '52': 'Pays de la Loire',
                '53': 'Bretagne',
                '75': 'Nouvelle Aquitaine',
                '76': 'Occitanie',
                '84': 'Auvergne Rhone Alpes',
                '93': 'Provence Alpes Cote d\'Azur',
                '94': 'Corse'
            }
            Papa.parse("https://www.data.gouv.fr/fr/datasets/r/9b1e6c8c-7e1d-47f9-9eb9-f2eeaab60d99", {
                download: true,
                complete: function (results, file) {
                    let newJsonObj = results.data;
                    newJsonObj.shift();
                    newJsonObj.sort((a, b) => parseInt(a[2]) < parseInt(b[2]) ? 1 : -1)
                    newJsonObj.shift();
                    //graph vacc total
                    var ctxRegions = document.querySelector('#chart9_regionVax').getContext('2d');
                    var chart = new Chart(ctxRegions, {
                        type: 'horizontalBar',
                        data: {
                            labels: newJsonObj.map(e => codeRegions[e[0]]),
                            datasets: [{
                                label: "Nb de personnes vaccinée contre le COVID-19",
                                backgroundColor: '#6219D8',
                                data: newJsonObj.map(e => e[2])
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                position: "bottom",
                                fontFamily: "Lexend Deca",
                                text: "Source : data.gouv.fr"
                            },
                            tooltips: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                yAxes: [{
                                    gridLines: {
                                        display: false
                                    }
                                }],
                                xAxes: [{
                                    stacked: true,
                                    step: 5000,
                                    ticks: {
                                        userCallback: function (value, index, values) {
                                            value = value.toString();
                                            value = value.split(/(?=(?:...)*$)/);
                                            value = value.join(',');
                                            return value;
                                        }
                                    }
                                }]
                            },
                            maintainAspectRatio: false,
                            plugins: {
                                deferred: {
                                    xOffset: 150,
                                    yOffset: '50%',
                                    delay: 500
                                }
                            },
                        }
                    });
                }
            })


            let colorsBubbleCountry = {
                "France": "#006CE0CC",
                "Germany": "#CBA135CC",
                "China": "#BC4749CC",
                "Israel": "#65AFFFCC",
                "United States": "#595959CC",
                "Brazil": "#4B7F52CC",
                "Canada": "#F97068CC",
                "Spain": "#FADF63CC",
                "India": "#F29E4CCC",
                "Italy": "#69B578CC",
                "Japan": "#D4D4D8CC",
                "Russia": "#225281CC"
            }
            fetch(
                    "https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/latest/owid-covid-latest.json", {
                        cache: "no-store"
                    }
                )
                .then(response => response.json())
                .then(json => {
                    dataPays.push(json.FRA);
                    dataPays.push(json.DEU);
                    dataPays.push(json.ESP);
                    dataPays.push(json.ITA);
                    dataPays.push(json.USA);
                    dataPays.push(json.CHN);
                    dataPays.push(json.RUS);
                    dataPays.push(json.JPN);
                    dataPays.push(json.ISR);
                    dataPays.push(json.BRA);
                    dataPays.push(json.IND);
                    dataPays.push(json.CAN);
                    //USA & Chine & UK & Italy & Espagne & Russie & Inde & Afrique du Sud & Israel
                    var ctxCompet = document.querySelector("#chart10_VaxCompet").getContext('2d');
                    var chart = new Chart(ctxCompet, {
                        type: 'bubble',
                        data: {
                            datasets: dataPays.map(a => {
                                return {
                                    label: a["location"],
                                    backgroundColor: colorsBubbleCountry[a["location"]],
                                    data: [{
                                        y: a["new_cases_per_million"],
                                        x: a["total_vaccinations_per_hundred"],
                                        r: 8
                                    }]
                                }
                            })
                        },
                        options: {
                            responsive: true,
                            title: {
                                display: true,
                                position: "bottom",
                                fontFamily: "Lexend Deca",
                                text: "Source : OWID"
                            },
                            tooltips: {
                                intersect: false
                            },
                            legend: {
                                fullWidth: false,
                                position: "right"
                            },
                            scales: {
                                yAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Nouveaux cas par million'
                                    }
                                }],
                                xAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: '% total de la population vaccinnée'
                                    }
                                }]
                            },
                            maintainAspectRatio: false,
                            plugins: {
                                deferred: {
                                    xOffset: 150,
                                    yOffset: '50%',
                                    delay: 500
                                }
                            },
                        }
                    });
                })
        </script>

        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script src="ressources/gnrl.js"></script>
        <script>
            AOS.init()
        </script>
    </div>

</body>

</html>